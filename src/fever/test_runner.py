#!/usr/bin/env python
import os.path
from argparse import ArgumentParser

from scorer import *
import json

if __name__ == "__main__":
    parser = ArgumentParser()
    parser.add_argument("predictions_file")
    parser.add_argument("actual_file")
    args = parser.parse_args()

    contents = open(args.actual_file, "r").read()
    actual = [json.loads(str(item)) for item in contents.strip().split('\n')]

    submission_answer_file = os.path.join(args.predictions_file)
    contents = open(submission_answer_file, "r").read()
    predictions = [json.loads(str(item)) for item in contents.strip().split('\n')]

    skip = set(
        [70148, 56837, 19469, 209938, 209941, 91675, 215582, 201759, 70177, 68642, 194597, 194598, 196647, 183342,
         85038, 210478, 168500, 183349, 195638, 168502, 168503, 35895, 23606, 10812, 44092, 177940, 168513, 115781,
         136262, 179782, 168519, 143431, 139337, 183371, 168524, 169038, 168527, 145999, 53843, 49758, 92766, 97712,
         190561, 190558, 27749, 60007, 153191, 97909, 138358, 46711, 39551, 64643, 11908, 197255, 6283, 4236, 190094,
         25743, 212623, 156303, 214671, 49814, 111254, 44183, 141465, 172187, 101534, 172190, 129183, 197278, 172191,
         190116, 197285, 186533, 82869, 172197, 176300, 43182, 70319, 191155, 133302, 166071, 212663, 37565, 162495,
         45765, 47307, 117963, 228557, 186571, 58575, 49876, 165076, 213718, 186583, 62678, 60637, 126687, 205025,
         187618, 190693, 49382, 190694, 141031, 168172, 41709, 93935, 176884, 181494, 42749, 132349, 193790, 109311,
         190722, 136963, 10503, 184583, 182023, 106759, 85255, 169228, 21259, 190734, 177934, 105743, 217874, 169235,
         88340, 34069, 166677, 148247, 64791, 169238, 188698, 44310, 169244, 112413, 197405, 192799, 169247, 177951,
         177954, 90915, 192803, 192805, 89894, 807, 192809, 208170, 192810, 131885, 172334, 192815, 192814, 28977,
         192818, 66867, 60212, 172853, 192822, 192823, 26423, 192821, 172858, 115003, 76791, 99646, 3391, 229186, 324,
         201029, 143173, 225605, 163657, 61773, 104783, 227159, 89943, 187742, 103263, 129887, 101733, 91494, 187752,
         187754, 187756, 187757, 187758, 187759, 187760, 187761, 187762, 187763, 187764, 195950, 187766, 187767, 113535,
         125314, 61828, 96646, 188299, 54158, 15764, 86423, 181655, 207772, 13213, 207773, 57759, 5534, 207779, 171428,
         13221, 207781, 224167, 227241, 123307, 92590, 207791, 207792, 82353, 65970, 207795, 168884, 207797, 207796,
         207798, 207799, 207800, 141754, 52155, 54716, 168893, 176054, 226751, 168895, 165314, 176067, 152516, 210371,
         149446, 175559, 49607, 210377, 210380, 57292, 210382, 73172, 210389, 210390, 166871, 210391, 224727, 198615,
         210396, 68060, 60382, 141279, 224735, 69087, 58337, 209891, 224740, 88035, 73702, 53735, 69606, 5094, 128491,
         180204, 209901, 149790, 172015, 45551, 224755, 209909, 126454, 112630, 224757, 90617, 18428, 80893, 65023])

    final_predictions = []
    final_actual = []

    for prediction, gold in zip(predictions,actual):
        if "id" in prediction and prediction['id'] in skip:
            continue
        elif "id" in gold and gold["id"] in skip:
            continue

        final_predictions.append(prediction)
        final_actual.append(gold)

    strict_score, acc_score, pr, rec, f1 = fever_score(final_predictions, final_actual)

    print("FEVER Score: \t\t{0}".format(round(strict_score,4)))
    print("--")
    print("Accuracy: \t\t{0}".format(round(acc_score,4)))
    print("Evidence Precision: \t{0}".format(round(pr,4)))
    print("Evidence Recall: \t{0}".format(round(rec,4)))
    print("Evidence F1: \t\t{0}".format(round(f1,4)))
